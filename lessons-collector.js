!function(t){var e={};function n(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(o,s,function(e){return t[e]}.bind(null,s));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://localhost:3002/",n(n.s=26)}({0:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));class o{static fileNameNormalize(t){let e=t.trim().split(""),n={"\\":"_","/":"_",":":"-","*":"_","?":"7",'"':"'","<":"{",">":"}","|":" l "};return e=e.map(t=>n[t]||t),e.join("")}static fileNameExt(t){let e=t.match(/.*(\.\w*)/i);return e&&e[1]}static blob2base64(t){return new Promise(e=>{let n=new FileReader;n.onload=t=>e(t.target.result),n.readAsDataURL(t)})}static StrBytes(t){var e,n,o,s=0,r=t.length;for(o=0;o<r;o++)(e=t.charCodeAt(o))>=55296&&e<57344&&e<56320&&o+1<r&&(n=t.charCodeAt(o+1))>=56320&&n<57344?(s+=4,o++):s+=e<128?1:e<2048?2:3;return s}static Percent(t,e,n=2){if(0===e)return(0).toFixed(n);return(100*t/e).toFixed(n)}static FileSize(t=0,e=!1){if(t=+t,isNaN(t))return!1;let n=0,o=["Б","КБ","МБ","ГБ","ТБ"];function s(t){return t>1024&&n<4?(n++,s(t/1024)):t}return e?{size:s(t),level:n,unit:o[n]}:`${s(t).toFixed(1)} ${o[n]}`}static UrlParse(t){var e={},n=t.match(/(http\:\/\/|https\:\/\/|ftp\:\/\/|file\:\/\/\/)(.*?\/)(.*\/)*(.*)(\/.*\.(.*))*/i);if(e.schema=n[1],e.host=n[2],n[3]&&(e.path=n[3].split("/"),e.path=e.path.filter((function(t){return t.length>0}))),n[4]){var o=n[4].split(".");if(o.length>1){var s=o.pop(),r=o.join(".");e.file={fileName:r+"."+s,name:r,ext:s}}else e.path.push(n[4])}return e}static TimeNormalizer(t=0,e=!1,n=!1){if("number"!=typeof t||t<0)return!1;let o=[],s=t/1e3,r={day:"д",hour:"ч",min:"мин",sec:"с",msec:"мс"},a=60,i=3600,l=86400,c=!1;function u(t,e){e<=0&&!c||(c=!0,o.push({unit:r[t],value:e}))}let h=Math.floor(s/l);u("day",h),s-=h*l;let d=Math.floor(s/i);u("hour",d),s-=d*i,u("min",Math.floor(s/a));let m=Math.floor(s%60);(!e&&!c||m>0)&&(c=!0,u("sec",m));let f=Math.round(1e3*(s%60-m));return!e&&c||(c=!0,u("msec",f)),n?o:o.reduce((t,e,n)=>t+`${n>0?" ":""}${e.value}${e.unit}`,"")}}},2:function(t,e,n){var o,s,r;s=[],void 0===(r="function"==typeof(o=function(){return function t(e,n,o){var s,r,a=window,i="application/octet-stream",l=o||i,c=e,u=!n&&!o&&c,h=document.createElement("a"),d=function(t){return String(t)},m=a.Blob||a.MozBlob||a.WebKitBlob||d,f=n||"download";if(m=m.call?m.bind(a):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(f=u.split("/").pop().split("?")[0],h.href=u,-1!==h.href.indexOf(u))){var p=new XMLHttpRequest;return p.open("GET",u,!0),p.responseType="blob",p.onload=function(e){t(e.target.response,f,i)},setTimeout((function(){p.send()}),0),p}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&m!==d))return navigator.msSaveBlob?navigator.msSaveBlob(w(c),f):k(c);l=(c=w(c)).type||i}else if(/([\x80-\xff])/.test(c)){for(var y=0,b=new Uint8Array(c.length),g=b.length;y<g;++y)b[y]=c.charCodeAt(y);c=new m([b],{type:l})}function w(t){for(var e=t.split(/[:;,]/),n=e[1],o=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),s=o.length,r=0,a=new Uint8Array(s);r<s;++r)a[r]=o.charCodeAt(r);return new m([a],{type:n})}function k(t,e){if("download"in h)return h.href=t,h.setAttribute("download",f),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout((function(){h.click(),document.body.removeChild(h),!0===e&&setTimeout((function(){a.URL.revokeObjectURL(h.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,i)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,i)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)}if(s=c instanceof m?c:new m([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(s,f);if(a.URL)k(a.URL.createObjectURL(s),!0);else{if("string"==typeof s||s.constructor===d)try{return k("data:"+l+";base64,"+a.btoa(s))}catch(t){return k("data:"+l+","+encodeURIComponent(s))}(r=new FileReader).onload=function(t){k(this.result)},r.readAsDataURL(s)}return!0}})?o.apply(e,s):o)||(t.exports=r)},26:function(t,e,n){"use strict";n.r(e);var o=n(2),s=n.n(o),r=n(0);class a{static async collectCourseInfo(){const t=location.href.replace(location.search,""),e=document.querySelector("h1.raw-title").textContent,n=document.querySelector(".book-wrap-img").src,o=[...document.querySelectorAll(".book-wrap-info .course-box-item")].map(t=>({title:t.querySelector(".course-box-title").textContent.trim(),value:t.querySelector(".course-box-value").textContent.trim()})),s=document.querySelector(".book-wrap-content .book-wrap-description").cloneNode(!0),r=s.querySelector(".book-wrap-more");r&&r.remove();return{url:t,name:e,posterUrl:n,infoItems:o,description:s.textContent.trim()}}static async collectLessonsData(t){let e=(await axios.get((t=>`/api/v1/course/${t}/lessons`)(t))).data,n=document.querySelector("#lessons-list").querySelectorAll(".lessons-item"),o=[];return n.forEach((t,n)=>{let s=e[n],a={index:n,name_prefix:r.a.fileNameNormalize(t.querySelector(".lessons-title").textContent),name_concat:" ",lesson_name:r.a.fileNameNormalize(t.querySelector(".lessons-name").textContent),storage_name:n,url:s.file,ext:r.a.UrlParse(s.file).file.ext,content:null,mime:null,total:0,loaded:0,percent:0,is_checked:!0,is_loading:!1,is_loaded:!1,was_loaded:!1};o.push(a)}),o}static async collectMaterials(t,e){let n=document.querySelectorAll(".container>a[title]");if(0===n.length)return!1;let o=[];return n.forEach((s,a)=>{let i="Материалы курса";n.length>1&&(i+=` [${a+1}]`);let l={index:t+a,name_prefix:i,name_concat:" - ",lesson_name:r.a.fileNameNormalize(e),storage_name:r.a.UrlParse(s.href).file.name,url:s.href,ext:r.a.UrlParse(s.href).file.ext,content:null,mime:null,total:0,loaded:0,percent:0,is_checked:!0,is_loading:!1,is_loaded:!1,was_loaded:!1};o.push(l)}),o}}class i{constructor(t=[]){this.running=!1,this.rafId=0,this.tasks=[],this.add=t=>{let e=[],n=!1;return t instanceof Array?(n=[],e=t):t instanceof Object&&e.push(t),e.forEach(t=>{if(!t.condition||"function"!=typeof t.condition)return void console.warn("Launcher: не передано условие",t);if(!t.callback||"function"!=typeof t.callback)return void console.warn("Launcher: не передан коллбек",t);t.attempts=t.attempts||1/0,t.tryNum=0,t.run=t.run||!1,t.complete=null,this.tasks.push(t);let e=this.tasks.length-1;n instanceof Array?n.push(e):n=e}),this._launch(),n},this.hasActive=()=>this.tasks.some(t=>t.run),this._launch=t=>{(this.rafId===t||!this.running&&this.hasActive())&&(this.running=!0,this.tasks.forEach((t,e)=>{t.run&&(t.condition.call(this)?(console.log(`Выполнен таск ${t.name} за ${t.tryNum} попыток`),this.stop(e),t.complete=!0,t.callback.call(this,"function"==typeof t.arg?t.arg.call(this,e):t.arg)):t.condition.call(this)||(t.tryNum++,t.tryNum>=t.attempts&&(this.stop(e),t.complete=!1)))}),this.hasActive()?this.rafId=requestAnimationFrame(()=>this._launch(this.rafId)):this.stop())},this._runTask=(t,e)=>{let n=this.findIndex(t);return!1!==n&&(!(!e&&this.tasks[n].run)&&(this.tasks[n].run=!0,this.tasks[n].complete=null,e&&(this.tasks[n].arg=e),n))},this.run=(...t)=>{let e;return 0===t.length?(e=[],this.tasks.forEach((t,n)=>{this._runTask(n),e.push(n)})):1===t.length?e=this._runTask(t[0]):2===t.length&&(e=this._runTask(t[0],t[1])),this._launch(),e},this.stop=t=>{let e;if(void 0!==t){let n=this._stopTask(t);if(!1===n)return!1;e=n}else e=[],this.tasks.forEach((t,n)=>{this._stopTask(n),e.push(n)}),this.running=!1,cancelAnimationFrame(this.rafId),this.rafId=0;return e},this.remove=t=>{let e;if(void 0!==t){let n=this._removeTask(t);if(!1===n)return!1;e=n}else e=[],this.tasks.forEach((t,n)=>{e.push(n)}),this.tasks=[];return e},this.add(t)}findIndex(t){let e;if("number"==typeof t&&this.tasks[t])e=t;else{if("string"!=typeof t)return!1;this.tasks.forEach((n,o)=>{n.name===t&&(e=o)}),e=void 0!==e&&e}return e}getTask(t){let e=this.findIndex(t);return!1!==e&&this.tasks[e]}_stopTask(t){let e=this.findIndex(t);return!1!==e&&(!!this.tasks[e].run&&(this.tasks[e].run=!1,this.tasks[e].tryNum=0,this.tasks[e].complete=!1,e))}_removeTask(t){let e=this.findIndex(t);return!1!==e&&(this.tasks.splice(e,1),e)}}var l=t=>{const{url:e,name:n,posterUrl:o,infoItems:s,description:r}=t;return`# [[курс] ${n}](${e})\n\n![](${o})\n\n${s.map(t=>`- ${t.title.toUpperCase()} **${t.value}**`).join("\n")}\n\n---\n${r}\n`};window.lessonsCollector=new class{constructor(){this.collectLessons=async()=>{this.json={url:window.location.href,course_name:"",course_display_name:"",lesson_items:[]};let t=r.a.UrlParse(document.location.href);t=t.path.pop(),this.setCourseName(t);let e=document.querySelector("h1.raw-title").textContent;this.setCourseDisplayName(e),await this.collectLessonItems(),await this.collectMaterials(),s()(JSON.stringify(this.json," ",4),r.a.fileNameNormalize(e)+".json","application/json"),this.createBtnLoader()},this.createBtnTask={name:"createBtnTask",condition:()=>null!==document.querySelector(".course-page-poster"),callback:()=>{this.createUI()}},this.taskLauncher=new i([this.createBtnTask]),this.json={url:window.location.href,course_name:"",course_display_name:"",lesson_items:[]},this.UI=null,this.init()}get cnt(){return this.json.lesson_items.length}get getCourseDisplayName(){return this.json.course_display_name}createUI(){const t=document.querySelector(".book-wrap .book-wrap-info");if(this.UI||!t)return;const e=document.createElement("div");e.className="lessons-collector-ui";const n=document.createElement("style");n.textContent="\n.lessons-collector-ui {\n    display: flex;\n    flex-wrap: wrap;\n    padding-bottom: 15px;\n}\n.lessons-collector-btn {\n    max-width: 300px;\n    margin-top: 15px;\n    margin-right: 15px;\n}\n\n@media only screen and (max-width : 860px) {\n    .lessons-collector-ui {\n        flex-direction: column;\n    }\n    .lessons-collector-btn {\n        max-width: none;\n        margin-right: 0;\n    }\n}\n";const o=this.createBtn(),s=this.createBtnLoader(),r=this.createBtnCourseInfo();e.append(n,o,s,r),t.after(e),this.UI=e}createBtn(){const t=document.createElement("button");return t.id="lessons-collector",t.className="btn book-wrap-btn lessons-collector-btn",t.textContent="Скачать json с уроками",t.addEventListener("click",this.collectLessons),t}createBtnLoader(){const t=document.createElement("a");return t.id="lessons-loader",t.className="btn book-wrap-btn lessons-collector-btn",t.textContent="Перейти на страницу скачивания",t.href="https://neyasbltb88.github.io/coursehunters-loader-v3/",t.target="_blank",t}createBtnCourseInfo(){const t=document.createElement("button");return t.id="btn-course-info",t.className="btn book-wrap-btn lessons-collector-btn",t.textContent="Скачать информацию о курсе",t.addEventListener("click",this.collectCourseInfo),t}async collectLessonItems(){let t=window.course_id,e=await a.collectLessonsData(t);e&&e.forEach(t=>this.addItem(t))}async collectMaterials(){try{let t=await a.collectMaterials(this.cnt,this.getCourseDisplayName);t.length>0&&t.forEach(t=>this.addItem(t))}catch(t){}}addItem(t){this.json.lesson_items.push(t)}setCourseName(t){this.json.course_name=t}setCourseDisplayName(t){this.json.course_display_name=t}async collectCourseInfo(){const t=await a.collectCourseInfo(),e=l(t),n=document.querySelector("h1.raw-title").textContent;console.log(e),s()(e,r.a.fileNameNormalize(n)+".md","text/markdown")}init(){this.taskLauncher.run("createBtnTask")}destroy(){this.UI&&(this.UI.remove(),this.UI=null)}}}});