!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://localhost:3002/",n(n.s=26)}({0:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{static fileNameNormalize(e){let t=e.trim().split(""),n={"\\":"_","/":"_",":":"-","*":"_","?":"7",'"':"'","<":"{",">":"}","|":" l "};return t=t.map(e=>n[e]||e),t.join("")}static fileNameExt(e){let t=e.match(/.*(\.\w*)/i);return t&&t[1]}static blob2base64(e){return new Promise(t=>{let n=new FileReader;n.onload=e=>t(e.target.result),n.readAsDataURL(e)})}static StrBytes(e){var t,n,o,s=0,r=e.length;for(o=0;o<r;o++)(t=e.charCodeAt(o))>=55296&&t<57344&&t<56320&&o+1<r&&(n=e.charCodeAt(o+1))>=56320&&n<57344?(s+=4,o++):s+=t<128?1:t<2048?2:3;return s}static Percent(e,t,n=2){if(0===t)return(0).toFixed(n);return(100*e/t).toFixed(n)}static FileSize(e=0,t=!1){if(e=+e,isNaN(e))return!1;let n=0,o=["Б","КБ","МБ","ГБ","ТБ"];function s(e){return e>1024&&n<4?(n++,s(e/1024)):e}return t?{size:s(e),level:n,unit:o[n]}:`${s(e).toFixed(1)} ${o[n]}`}static UrlParse(e){var t={},n=e.match(/(http\:\/\/|https\:\/\/|ftp\:\/\/|file\:\/\/\/)(.*?\/)(.*\/)*(.*)(\/.*\.(.*))*/i);if(t.schema=n[1],t.host=n[2],n[3]&&(t.path=n[3].split("/"),t.path=t.path.filter((function(e){return e.length>0}))),n[4]){var o=n[4].split(".");if(o.length>1){var s=o.pop(),r=o.join(".");t.file={fileName:r+"."+s,name:r,ext:s}}else t.path.push(n[4])}return t}static TimeNormalizer(e=0,t=!1,n=!1){if("number"!=typeof e||e<0)return!1;let o=[],s=e/1e3,r={day:"д",hour:"ч",min:"мин",sec:"с",msec:"мс"},a=60,i=3600,l=86400,c=!1;function u(e,t){t<=0&&!c||(c=!0,o.push({unit:r[e],value:t}))}let d=Math.floor(s/l);u("day",d),s-=d*l;let h=Math.floor(s/i);u("hour",h),s-=h*i,u("min",Math.floor(s/a));let m=Math.floor(s%60);(!t&&!c||m>0)&&(c=!0,u("sec",m));let f=Math.round(1e3*(s%60-m));return!t&&c||(c=!0,u("msec",f)),n?o:o.reduce((e,t,n)=>e+`${n>0?" ":""}${t.value}${t.unit}`,"")}}},26:function(e,t,n){"use strict";n.r(t);var o=n(4),s=n.n(o);var r=(e,t)=>{let n=!1;e instanceof Blob&&(n=!0,e=URL.createObjectURL(e));let o=((e,t)=>{let n=document.createElement("a");return n.href=e,n.setAttribute("download",t),n.className="download-js",n.innerHTML="downloading...",n.style.display="none",n.addEventListener("click",e=>e.stopPropagation(),{once:!0}),n})(e,t);return document.body.appendChild(o),setTimeout(()=>{o.click(),document.body.removeChild(o),n&&URL.revokeObjectURL(e)},66),!0},a=n(0);class i{static async collectCourseInfo(){const e=location.href.replace(location.search,""),t=document.querySelector("h1.raw-title").textContent,n=document.querySelector(".book-wrap-img").src,o=[...document.querySelectorAll(".book-wrap-info .course-box-item")].map(e=>({title:e.querySelector(".course-box-title").textContent.trim(),value:e.querySelector(".course-box-value").textContent.trim()})),s=document.querySelector(".book-wrap-content .book-wrap-description").cloneNode(!0),r=s.querySelector(".book-wrap-more");r&&r.remove();return{url:e,name:t,posterUrl:n,infoItems:o,description:s.textContent.trim()}}static async collectLessonsData(e){let t=(await axios.get((e=>`/api/v1/course/${e}/lessons`)(e))).data,n=document.querySelector("#lessons-list").querySelectorAll(".lessons-item"),o=[];return n.forEach((e,n)=>{let s=t[n],r={index:n,name_prefix:a.a.fileNameNormalize(e.querySelector(".lessons-title").textContent),name_concat:" ",lesson_name:a.a.fileNameNormalize(e.querySelector(".lessons-name").textContent),storage_name:n,url:s.file,ext:a.a.UrlParse(s.file).file.ext,content:null,mime:null,total:0,loaded:0,percent:0,is_checked:!0,is_loading:!1,is_loaded:!1,was_loaded:!1};o.push(r)}),o}static async collectMaterials(e,t){let n=document.querySelectorAll(".container>a[title]");if(0===n.length)return!1;let o=[];return n.forEach((s,r)=>{let i="Материалы курса";n.length>1&&(i+=` [${r+1}]`);let l={index:e+r,name_prefix:i,name_concat:" - ",lesson_name:a.a.fileNameNormalize(t),storage_name:a.a.UrlParse(s.href).file.name,url:s.href,ext:a.a.UrlParse(s.href).file.ext,content:null,mime:null,total:0,loaded:0,percent:0,is_checked:!0,is_loading:!1,is_loaded:!1,was_loaded:!1};o.push(l)}),o}}class l{constructor(e=[]){this.running=!1,this.rafId=0,this.tasks=[],this.add=e=>{let t=[],n=!1;return e instanceof Array?(n=[],t=e):e instanceof Object&&t.push(e),t.forEach(e=>{if(!e.condition||"function"!=typeof e.condition)return void console.warn("Launcher: не передано условие",e);if(!e.callback||"function"!=typeof e.callback)return void console.warn("Launcher: не передан коллбек",e);e.attempts=e.attempts||1/0,e.tryNum=0,e.run=e.run||!1,e.complete=null,this.tasks.push(e);let t=this.tasks.length-1;n instanceof Array?n.push(t):n=t}),this._launch(),n},this.hasActive=()=>this.tasks.some(e=>e.run),this._launch=e=>{(this.rafId===e||!this.running&&this.hasActive())&&(this.running=!0,this.tasks.forEach((e,t)=>{e.run&&(e.condition.call(this)?(console.log(`Выполнен таск ${e.name} за ${e.tryNum} попыток`),this.stop(t),e.complete=!0,e.callback.call(this,"function"==typeof e.arg?e.arg.call(this,t):e.arg)):e.condition.call(this)||(e.tryNum++,e.tryNum>=e.attempts&&(this.stop(t),e.complete=!1)))}),this.hasActive()?this.rafId=requestAnimationFrame(()=>this._launch(this.rafId)):this.stop())},this._runTask=(e,t)=>{let n=this.findIndex(e);return!1!==n&&(!(!t&&this.tasks[n].run)&&(this.tasks[n].run=!0,this.tasks[n].complete=null,t&&(this.tasks[n].arg=t),n))},this.run=(...e)=>{let t;return 0===e.length?(t=[],this.tasks.forEach((e,n)=>{this._runTask(n),t.push(n)})):1===e.length?t=this._runTask(e[0]):2===e.length&&(t=this._runTask(e[0],e[1])),this._launch(),t},this.stop=e=>{let t;if(void 0!==e){let n=this._stopTask(e);if(!1===n)return!1;t=n}else t=[],this.tasks.forEach((e,n)=>{this._stopTask(n),t.push(n)}),this.running=!1,cancelAnimationFrame(this.rafId),this.rafId=0;return t},this.remove=e=>{let t;if(void 0!==e){let n=this._removeTask(e);if(!1===n)return!1;t=n}else t=[],this.tasks.forEach((e,n)=>{t.push(n)}),this.tasks=[];return t},this.add(e)}findIndex(e){let t;if("number"==typeof e&&this.tasks[e])t=e;else{if("string"!=typeof e)return!1;this.tasks.forEach((n,o)=>{n.name===e&&(t=o)}),t=void 0!==t&&t}return t}getTask(e){let t=this.findIndex(e);return!1!==t&&this.tasks[t]}_stopTask(e){let t=this.findIndex(e);return!1!==t&&(!!this.tasks[t].run&&(this.tasks[t].run=!1,this.tasks[t].tryNum=0,this.tasks[t].complete=!1,t))}_removeTask(e){let t=this.findIndex(e);return!1!==t&&(this.tasks.splice(t,1),t)}}var c=e=>{const{url:t,name:n,posterUrl:o,infoItems:s,description:r}=e;return`# [[курс] ${n}](${t})\n\n![](${o})\n\n${s.map(e=>`- ${e.title.toUpperCase()} **${e.value}**`).join("\n")}\n\n---\n${r}\n`};window.lessonsCollector=new class{constructor(){this.collectLessons=async()=>{this.json={url:window.location.href,course_name:"",course_display_name:"",lesson_items:[]};let e=a.a.UrlParse(document.location.href);e=e.path.pop(),this.setCourseName(e);let t=document.querySelector("h1.raw-title").textContent;this.setCourseDisplayName(t),await this.collectLessonItems(),await this.collectMaterials(),s()(JSON.stringify(this.json," ",4),a.a.fileNameNormalize(t)+".json","application/json"),this.createBtnLoader()},this.createBtnTask={name:"createBtnTask",condition:()=>null!==document.querySelector(".course-page-poster"),callback:()=>{this.createUI()}},this.taskLauncher=new l([this.createBtnTask]),this.json={url:window.location.href,course_name:"",course_display_name:"",lesson_items:[]},this.UI=null,this.init()}get cnt(){return this.json.lesson_items.length}get getCourseDisplayName(){return this.json.course_display_name}createUI(){const e=document.querySelector(".book-wrap .book-wrap-info");if(this.UI||!e)return;const t=document.createElement("div");t.className="lessons-collector-ui";const n=document.createElement("style");n.textContent="\n.lessons-collector-ui {\n    display: flex;\n    flex-wrap: wrap;\n    padding-bottom: 15px;\n}\n.lessons-collector-btn {\n    max-width: 300px;\n    margin-top: 15px;\n    margin-right: 15px;\n}\n\n@media only screen and (max-width : 860px) {\n    .lessons-collector-ui {\n        flex-direction: column;\n    }\n    .lessons-collector-btn {\n        max-width: none;\n        margin-right: 0;\n    }\n}\n";const o=this.createBtn(),s=this.createBtnLoader(),r=this.createBtnCourseInfo();t.append(n,o,s,r),e.after(t),this.UI=t}createBtn(){const e=document.createElement("button");return e.id="lessons-collector",e.className="btn book-wrap-btn lessons-collector-btn",e.textContent="Скачать json с уроками",e.addEventListener("click",this.collectLessons),e}createBtnLoader(){const e=document.createElement("a");return e.id="lessons-loader",e.className="btn book-wrap-btn lessons-collector-btn",e.textContent="Перейти на страницу скачивания",e.href="https://neyasbltb88.github.io/coursehunters-loader-v3/",e.target="_blank",e}createBtnCourseInfo(){const e=document.createElement("button");return e.id="btn-course-info",e.className="btn book-wrap-btn lessons-collector-btn",e.textContent="Скачать информацию о курсе",e.addEventListener("click",this.collectCourseInfo),e}async collectLessonItems(){let e=window.course_id,t=await i.collectLessonsData(e);t&&t.forEach(e=>this.addItem(e))}async collectMaterials(){try{let e=await i.collectMaterials(this.cnt,this.getCourseDisplayName);e.length>0&&e.forEach(e=>this.addItem(e))}catch(e){}}addItem(e){this.json.lesson_items.push(e)}setCourseName(e){this.json.course_name=e}setCourseDisplayName(e){this.json.course_display_name=e}async collectCourseInfo(){const e=await i.collectCourseInfo(),t=c(e),n=document.querySelector("h1.raw-title").textContent;console.log(t);const o=(new TextEncoder).encode(t),s=new Blob([o],{type:"text/markdown"});r(s,a.a.fileNameNormalize(n)+".md")}init(){this.taskLauncher.run("createBtnTask")}destroy(){this.UI&&(this.UI.remove(),this.UI=null)}}},4:function(e,t,n){var o,s,r;s=[],void 0===(r="function"==typeof(o=function(){return function e(t,n,o){var s,r,a=window,i="application/octet-stream",l=o||i,c=t,u=!n&&!o&&c,d=document.createElement("a"),h=function(e){return String(e)},m=a.Blob||a.MozBlob||a.WebKitBlob||h,f=n||"download";if(m=m.call?m.bind(a):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),u&&u.length<2048&&(f=u.split("/").pop().split("?")[0],d.href=u,-1!==d.href.indexOf(u))){var p=new XMLHttpRequest;return p.open("GET",u,!0),p.responseType="blob",p.onload=function(t){e(t.target.response,f,i)},setTimeout((function(){p.send()}),0),p}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&m!==h))return navigator.msSaveBlob?navigator.msSaveBlob(w(c),f):k(c);l=(c=w(c)).type||i}else if(/([\x80-\xff])/.test(c)){for(var y=0,b=new Uint8Array(c.length),g=b.length;y<g;++y)b[y]=c.charCodeAt(y);c=new m([b],{type:l})}function w(e){for(var t=e.split(/[:;,]/),n=t[1],o=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),s=o.length,r=0,a=new Uint8Array(s);r<s;++r)a[r]=o.charCodeAt(r);return new m([a],{type:n})}function k(e,t){if("download"in d)return d.href=e,d.setAttribute("download",f),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===t&&setTimeout((function(){a.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,i)),n.src=e,setTimeout((function(){document.body.removeChild(n)}),333)}if(s=c instanceof m?c:new m([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(s,f);if(a.URL)k(a.URL.createObjectURL(s),!0);else{if("string"==typeof s||s.constructor===h)try{return k("data:"+l+";base64,"+a.btoa(s))}catch(e){return k("data:"+l+","+encodeURIComponent(s))}(r=new FileReader).onload=function(e){k(this.result)},r.readAsDataURL(s)}return!0}})?o.apply(t,s):o)||(e.exports=r)}});